Story:
    Print "=== Environment Variable Tests ==="
    Print ""

    # IMPORTANT: Load .env file at startup (before any async operations)
    Print "Loading environment variables from .env file..."
    Count is Env.Load("tests/assets/test.env")
    Print "Loaded " + Count + " variables"
    Print ""

    # Test 1: Get environment variable
    Print "Test 1: Get environment variable"
    ApiKey is Env.Get("TEST_API_KEY")
    Print "TEST_API_KEY: " + ApiKey
    If ApiKey = "test_key_12345":
        Print "✓ Test 1 passed"
    Else:
        Print "✗ Test 1 failed"
    Print ""

    # Test 2: Get with default value
    Print "Test 2: Get with default value"
    DefaultValue is Env.Get("NONEXISTENT_VAR", "default_value")
    Print "Getting nonexistent var with default"
    Print "Got: " + DefaultValue
    If DefaultValue = "default_value":
        Print "✓ Test 2 passed"
    Else:
        Print "✗ Test 2 failed"
    Print ""

    # Test 3: Get without default (returns empty string)
    Print "Test 3: Get without default"
    EmptyValue is Env.Get("ANOTHER_NONEXISTENT")
    Print "Getting nonexistent var without default"
    If EmptyValue = "":
        Print "Got empty string as expected"
        Print "✓ Test 3 passed"
    Else:
        Print "✗ Test 3 failed"
    Print ""

    # Test 4: Has - check existence
    Print "Test 4: Check if variable exists"
    Exists is Env.Has("TEST_API_KEY")
    NotExists is Env.Has("SFX_DOESNT_EXIST")
    Print "TEST_API_KEY exists: " + Exists
    Print "SFX_DOESNT_EXIST exists: " + NotExists
    If Exists = True:
        If NotExists = False:
            Print "✓ Test 4 passed"
        Else:
            Print "✗ Test 4 failed"
    Else:
        Print "✗ Test 4 failed"
    Print ""

    # Test 5: Get variables from .env file
    Print "Test 5: Get variables loaded from .env file"
    AppName is Env.Get("TEST_APP_NAME")
    Port is Env.Get("TEST_PORT")
    Debug is Env.Get("TEST_DEBUG")
    Print "TEST_APP_NAME: " + AppName
    Print "TEST_PORT: " + Port
    Print "TEST_DEBUG: " + Debug
    If AppName = "SFXLanguage":
        If Port = "8080":
            If Debug = "True":
                Print "✓ Test 5 passed"
            Else:
                Print "✗ Test 5 failed"
        Else:
            Print "✗ Test 5 failed"
    Else:
        Print "✗ Test 5 failed"
    Print ""

    # Test 6: .env file with comments
    Print "Test 6: .env file handles comments correctly"
    Comment is Env.Get("TEST_COMMENT")
    If Comment = "":
        Print "Comments correctly ignored"
        Print "✓ Test 6 passed"
    Else:
        Print "✗ Test 6 failed"
    Print ""

    # Test 7: Quoted values in .env
    Print "Test 7: Quoted values in .env file"
    QuotedValue is Env.Get("TEST_QUOTED")
    SingleQuoted is Env.Get("TEST_SINGLE")
    Print "TEST_QUOTED: " + QuotedValue
    Print "TEST_SINGLE: " + SingleQuoted
    If QuotedValue = "This is a quoted value":
        If SingleQuoted = "Single quoted":
            Print "✓ Test 7 passed"
        Else:
            Print "✗ Test 7 failed"
    Else:
        Print "✗ Test 7 failed"
    Print ""

    # Test 8: All environment variables
    Print "Test 8: Get all environment variables"
    AllVars is Env.All()
    HasTestVar is Env.Has("TEST_API_KEY")
    Print "Retrieved all environment variables"
    Print "Contains TEST_API_KEY: " + HasTestVar
    If HasTestVar = True:
        Print "✓ Test 8 passed"
    Else:
        Print "✗ Test 8 failed"
    Print ""

    # Test 9: Use case - API configuration
    Print "Test 9: Real-world use case - API configuration"
    DatabaseUrl is Env.Get("TEST_DATABASE_URL")
    MaxConnections is Env.Get("TEST_MAX_CONNECTIONS")
    Print "Database Configuration:"
    Print "  URL: " + DatabaseUrl
    Print "  Max Connections: " + MaxConnections
    If DatabaseUrl = "postgresql://localhost:5432/sfx_db":
        If MaxConnections = "100":
            Print "✓ Test 9 passed"
        Else:
            Print "✗ Test 9 failed"
    Else:
        Print "✗ Test 9 failed"
    Print ""

    # Test 10: System environment variables
    Print "Test 10: Access system environment variables"
    Path is Env.Get("PATH", "not_found")
    HasPath is Env.Has("PATH")
    Print "PATH exists: " + HasPath
    If HasPath = True:
        Print "PATH variable found (length: " + Path.Length + ")"
        Print "✓ Test 10 passed"
    Else:
        Print "PATH not found (may be on Windows without PATH set)"
        Print "✓ Test 10 passed (conditional)"
    Print ""

    Print "=== All Environment Variable tests completed! ==="
    Print ""
    Print "Safety Note: Env.Load() should only be called at program startup"
    Print "before any async operations (HTTP, WebSocket, TCP, UDP) begin."
